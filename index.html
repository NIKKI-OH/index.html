<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Cyber Noir Gift</title>
<style>
    /* 引入高奢衬线体 & 科技字体 */
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,700&family=Rajdhani:wght@300;500;700&display=swap');

    body { 
        margin: 0; overflow: hidden; 
        background-color: #000; 
        font-family: 'Rajdhani', sans-serif;
    }

    /* UI 仅保留极简装饰，文字全部 3D 化 */
    #overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 10;
        background: radial-gradient(circle at center, transparent 0%, #000 120%);
    }

    /* 顶部装饰线 */
    .border-top {
        position: absolute; top: 20px; left: 20px; right: 20px; height: 1px;
        background: linear-gradient(90deg, transparent, #D4AF37, transparent);
        opacity: 0.5;
    }
    
    /* 状态指示器 */
    #status {
        position: absolute; bottom: 30px; width: 100%; text-align: center;
        color: rgba(212, 175, 55, 0.4); font-size: 10px; letter-spacing: 4px; text-transform: uppercase;
    }
    
    .input_video { display: none; }
</style>

<script src="https://lib.baomitu.com/three.js/r128/three.min.js"></script>
<script src="https://lib.baomitu.com/tween.js/18.6.4/tween.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>

<div id="overlay">
    <div class="border-top"></div>
    <div id="status">System Standby... Waiting for Input</div>
</div>
<video class="input_video"></video>
<div id="canvas-container"></div>

<script>
    // --- 0. 商业级配置 ---
    const PRIZES = ["HERMÈS", "Cartier Ring", "Trip to Paris", "Clear Cart", "520 RedPacket", "Movie Night"];
    const CHEAT_CODE = null; 

    const CONFIG = {
        count: 15000, 
        colors: {
            bg: 0x050505,
            primary: 0xD4AF37, // 香槟金
            secondary: 0x00F0FF, // 赛博蓝 (Cyber Cyan)
            accent: 0xFFFFFF   // 钻石白
        }
    };

    // --- 1. 场景 ---
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x000000, 0.03); // 纯黑深邃雾

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 0, 8.5);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // --- 2. 纹理资产 (Procedural Textures) ---
    
    // A. 粒子：锐利的钻石光芒 (Diamond Sparkle)
    function createDiamondTexture() {
        const canvas = document.createElement('canvas'); canvas.width = 64; canvas.height = 64;
        const ctx = canvas.getContext('2d');
        const cx = 32, cy = 32;
        
        // 核心辉光
        const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, 32);
        g.addColorStop(0, 'rgba(255,255,255,1)');
        g.addColorStop(0.1, 'rgba(255,255,255,0.8)');
        g.addColorStop(0.5, 'rgba(212,175,55,0.2)'); // 金色外溢
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = g; ctx.fillRect(0,0,64,64);
        
        // 星芒
        ctx.fillStyle = '#FFF';
        ctx.beginPath(); ctx.ellipse(cx, cy, 28, 1, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(cx, cy, 1, 28, 0, 0, Math.PI*2); ctx.fill();
        
        return new THREE.CanvasTexture(canvas);
    }

    // B. 全息文字板 (Holographic Text)
    function createTextTexture(text, style = 'normal') {
        const cvs = document.createElement('canvas'); cvs.width=1024; cvs.height=512;
        const ctx = cvs.getContext('2d');
        
        // 样式配置
        const isGlitch = style === 'glitch';
        const isResult = style === 'result';
        
        // 字体选择
        ctx.font = isResult ? "italic 700 80px 'Playfair Display'" : "500 70px 'Rajdhani'";
        ctx.textAlign = "center"; ctx.textBaseline = "middle";
        
        // 全息发光效果
        ctx.shadowBlur = isResult ? 40 : 15;
        ctx.shadowColor = isResult ? "#D4AF37" : "#00F0FF";
        
        if (isGlitch) {
            // 模拟乱码位移
            ctx.fillStyle = "rgba(0, 240, 255, 0.5)";
            ctx.fillText(text, 512 + Math.random()*10-5, 256);
            ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
            ctx.fillText(text, 512 - Math.random()*10+5, 256);
        }
        
        ctx.fillStyle = isResult ? "#FFF8DC" : "#E0FFFF";
        ctx.fillText(text, 512, 256);
        
        // 装饰线
        if(isResult) {
            ctx.strokeStyle = "rgba(212, 175, 55, 0.5)";
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(312, 320); ctx.lineTo(712, 320); ctx.stroke();
        }
        
        const t = new THREE.CanvasTexture(cvs); 
        t.needsUpdate=true; return t;
    }

    // --- 3. 3D 对象构建 ---

    // [3.1] 粒子系统
    const geometry = new THREE.BufferGeometry();
    const pos=[], col=[], sizes=[], randoms=[];
    const tGift=[], tTree=[], cGift=[], cTree=[];
    
    // 黄金螺旋算法 (Golden Spiral)
    const phi = Math.PI * (3 - Math.sqrt(5)); 

    for(let i=0; i<CONFIG.count; i++) {
        randoms.push(Math.random());

        // --- Gift: 悬浮的能量矩阵 ---
        let gx = (Math.random()-0.5) * 3;
        let gy = (Math.random()-0.5) * 3;
        let gz = (Math.random()-0.5) * 3;
        // 强化边缘
        if(Math.random()>0.6) {
            if(Math.random()>0.5) gx = Math.sign(gx)*1.5
